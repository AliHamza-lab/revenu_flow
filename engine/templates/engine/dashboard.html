{% extends 'engine/base.html' %}

{% block content %}
<div class="header animate-fade">
    <div>
        <h1>Dashboard</h1>
        <p style="color: var(--text-muted); margin-top: 0.5rem;">Audit lead lists and datasets for precision integrity.
        </p>
    </div>
</div>

<div class="grid"
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
    <!-- Upload Card -->
    <div class="card animate-fade"
        style="grid-column: span 2; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px dashed var(--border); padding: 3rem;">
        <form action="{% url 'run_audit' %}" method="post" enctype="multipart/form-data" id="auditForm"
            style="text-align: center;">
            {% csrf_token %}
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
            <h3 style="margin-bottom: 0.5rem;">Upload Dataset for Audit</h3>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Support for CSV and XLSX files up to 50MB</p>
            <input type="file" name="data_file" id="fileInput" style="display: none;" onchange="this.form.submit()">
            <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">Select
                File</button>
        </form>
    </div>

    <!-- Quick Stats -->
    <div class="card animate-fade" style="animation-delay: 0.1s;">
        <h3>Global Stats</h3>
        <div style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-muted);">Total Audits</span>
                <strong>{{ sessions.count }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-muted);">Avg. Health</span>
                <strong style="color: var(--primary);">85.4%</strong>
            </div>
        </div>
    </div>
</div>

<div class="animate-fade" style="animation-delay: 0.2s;">
    <h2 style="margin-bottom: 1.5rem;">Recent Audit History</h2>
    <div class="card" style="padding: 0;">
        <table style="width: 100%; border-collapse: collapse; text-align: left;">
            <thead>
                <tr style="background: var(--bg); border-bottom: 1px solid var(--border);">
                    <th style="padding: 1rem;">File Name</th>
                    <th style="padding: 1rem;">Rows</th>
                    <th style="padding: 1rem;">Errors</th>
                    <th style="padding: 1rem;">Health Index</th>
                    <th style="padding: 1rem;">Date</th>
                    <th style="padding: 1rem;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for session in sessions %}
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 1rem;"><strong>{{ session.file_name }}</strong></td>
                    <td style="padding: 1rem;">{{ session.row_count }}</td>
                    <td style="padding: 1rem; color: var(--danger);">{{ session.error_count }}</td>
                    <td style="padding: 1rem;">
                        <span
                            style="padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; 
                            background: {% if session.health_score > 80 %}#dcfce7{% elif session.health_score > 50 %}#fef3c7{% else %}#fee2e2{% endif %};
                            color: {% if session.health_score > 80 %}#166534{% elif session.health_score > 50 %}#92400e{% else %}#991b1b{% endif %};">
                            {{ session.health_score }}%
                        </span>
                    </td>
                    <td style="padding: 1rem; color: var(--text-muted); font-size: 0.875rem;">{{
                        session.created_at|date:"M d, H:i" }}</td>
                    <td style="padding: 1rem;"><a href="{% url 'audit_result' session.id %}" class="btn btn-outline"
                            style="padding: 0.4rem 0.8rem; font-size: 0.875rem;">View</a></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="padding: 3rem; text-align: center; color: var(--text-muted);">No audits
                        performed yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}